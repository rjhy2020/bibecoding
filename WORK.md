WORK PLAN — 스피킹: 3회 반복 루프(마스킹 포함)

목표
- 1세트(예: 10문장)를 3라운드로 반복하여 총 30회 스피킹 루프를 구성한다.
- Round 1: 현재와 동일(전체 단어 표시, STT 활성, 맞춘 단어 초록).
- Round 2: 일부 단어를 회색 박스로 마스킹. 사용자가 해당 단어를 말하면 박스가 초록으로 바뀌며 단어가 드러난다.
- Round 3: 모든 단어 마스킹(“다 가리기”). TTS 비활성. STT 가능(스피킹만).

범위
- `lib/features/speaking/speaking_page.dart` 내부 상태/렌더/매칭/네비게이션 로직 확장. 서비스/API 변경 없음.

설계/상태
- 라운드: `int _round` (0,1,2). 진행 카운트: `current = _round * _items.length + _index + 1`, 총계: `total = _items.length * 3`.
- 마스킹 플래그: `List<bool> _maskFlags`(표시용 토큰 길이와 동일).
  - Round 1: 전부 false(마스킹 없음).
  - Round 2: 내용 토큰 중 약 35%를 true로(최소 1개). 길이>2, 영숫자 토큰 우선. 문장부호 제외.
  - Round 3: 내용 토큰 전부 true.
- 안정성: 라운드 2의 마스킹은 문장별 해시 기반 난수로 선택(재방문 시 일관성), 필요 시 재계산 허용.

UI/동작
- WordChip 확장: `masked`와 `matched`를 모두 고려.
  - `masked && !matched`: 회색 박스(텍스트 숨김).
  - `matched`: 초록색 칩 + 실제 텍스트 표시.
  - 그 외: 기본 칩(현재 구현 유지).
- STT 버튼:
  - Round 1~3: 활성(현행 토글 유지). Round 3에서도 스피킹 가능.
- TTS 버튼: Round 1~2에서만 가능(스피킹 중에는 비활성 유지). Round 3은 항상 비활성.
- 자동 재생: 첫 진입/카드 전환 시 TTS 자동 재생(현행 정책 유지).
- 진행 표시: `(${current}/${total})`로 표기.

매칭 로직
- 현재 BoW 매칭 유지. `onResult`에서 `_matchedFlags` 갱신 후,
  - Round 2: 마스킹된 토큰이 매칭되면 해당 칩이 초록으로 변화하며 텍스트를 드러냄.
  - Round 3: STT 활성. 마스킹된 토큰이 매칭되면 칩이 초록으로 변화하며 텍스트를 드러냄.

네비게이션
- `next()`에서 `_index` 증가. 마지막 인덱스에서 다음은 `_index=0, _round++`.
- `_round==3`이면 루프 종료(완료 메시지 후 페이지 종료).

수락 기준(DoD)
- 예문 10개 기준, 진행 표시가 1/30 → 30/30까지 증가.
- Round 2에서 선택된 단어만 회색 박스로 가려지고, 해당 단어를 말하면 초록으로 변하며 드러남.
- Round 3에서 TTS 버튼 비활성화(항상). 모든 단어가 회색 박스로 표시되며, STT로 단어를 말하면 초록으로 변함.

테스트
- 시나리오 1: 10문장 세트로 진입 → 30스텝 진행되는지 확인.
- 시나리오 2: Round 2에서 길이>2 토큰이 최소 1개 이상 마스킹되는지, 발화 시 초록 전환되는지.
- 시나리오 3: Round 3에서 STT 버튼 비활성/툴팁 노출, TTS/다음 동작 확인.
- 시나리오 4: 진행 표시와 자동 재생이 라운드 전환 시 정상 동작.

작업 단계
1) 상태 확장: `_round`, `_maskFlags`, 진행 계산 로직 추가.
2) 마스킹 선택기: 문장 토큰화 후 라운드별 `_maskFlags` 생성 함수 구현(해시 기반 랜덤).
3) UI 반영: `_WordChip(masked: ..., matched: ...)`로 렌더링 분기.
4) TTS 게이트: Round 3에서 TTS 버튼 비활성화.
5) 네비게이션: 3라운드 순환/완료 처리 + 진행 표시 업데이트.
6) 수동/자동 테스트 및 미세 조정.

상태
- Proposed — 승인 시 반영(추정 2~4시간, 리스크 중간: UI/상태 동기화).
